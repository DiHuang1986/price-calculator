<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ä»·æ ¼è®¡ç®—å™¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-slide-in { animation: slideIn 0.5s ease-out; }
    #result:empty { display: none; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 p-2.5 pt-5 flex justify-center items-start sm:p-4 sm:items-center">

<div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-xl animate-slide-in">
  <h2 class="text-indigo-600 text-center mb-4 text-2xl font-bold">ğŸ’° ä»·æ ¼è®¡ç®—å™¨</h2>

  <div class="bg-gray-100 p-4 rounded-lg mb-3 border-l-4 border-indigo-600">
    <div class="flex justify-between items-center mb-3">
      <div class="text-gray-700 font-semibold text-sm">æ±‡ç‡è®¾ç½®</div>
      <button onclick="fetchRates()" id="fetchBtn" class="px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-semibold rounded-md transition-all shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
        ğŸ”„ è·å–å®æ—¶æ±‡ç‡
      </button>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">åŠ æ‹¿å¤§æ±‡ç‡</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-r-0 rounded-l-md text-gray-700 text-xs font-semibold whitespace-nowrap">1 USD =</span>
        <input id="cadRate" value="1.3667" oninput="convertCAD()" class="flex-1 px-3 border-2 border-gray-300 text-sm transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">CAD</span>
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">äººæ°‘å¸æ±‡ç‡</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-r-0 rounded-l-md text-gray-700 text-xs font-semibold whitespace-nowrap">1 USD =</span>
        <input id="cnyRate" value="7.24" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">CNY</span>
      </div>
    </div>
  </div>

  <div class="bg-gray-100 p-4 rounded-lg mb-3 border-l-4 border-indigo-600">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">åŠ å¸æˆæœ¬</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-r-0 rounded-l-md text-gray-700 text-xs font-semibold">CAD</span>
        <input id="cad" value="199" oninput="convertCAD()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-r-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">æŠ˜ç®—ç¾å…ƒ</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-r-0 rounded-l-md text-gray-700 text-xs font-semibold">USD</span>
        <input id="usd" value="145.668" oninput="convertUSD()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-r-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">é‡‡è´­ä½£é‡‘</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <input id="buyRate" value="2" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-l-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">%</span>
      </div>
    </div>
  </div>

  <div class="bg-gray-100 p-4 rounded-lg mb-3 border-l-4 border-indigo-600">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">å›½é™…è¿è´¹</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-r-0 rounded-l-md text-gray-700 text-xs font-semibold">Â¥</span>
        <input id="ship" value="22.95" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-r-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">ä¿ç¨ä»“è´¹ç”¨</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-r-0 rounded-l-md text-gray-700 text-xs font-semibold">Â¥</span>
        <input id="bond" value="12.52" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-r-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
      </div>
    </div>
  </div>

  <div class="bg-gray-100 p-4 rounded-lg mb-3 border-l-4 border-indigo-600">
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">å¹³å°æŠ½ä½£</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <input id="platform" value="6" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-l-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">%</span>
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">ç¨é‡‘</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <input id="tax" value="9.11" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-l-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">%</span>
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">å¸¦è´§ä½£é‡‘</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <input id="live" value="1" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-l-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">%</span>
      </div>
    </div>
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2.5 last:mb-0">
      <label class="text-gray-800 font-medium text-sm sm:flex-1">æ¯›åˆ©</label>
      <div class="flex items-stretch h-9 w-full sm:w-60">
        <input id="profit" value="5" oninput="calc()" class="flex-1 px-3 border-2 border-gray-300 text-sm rounded-l-md transition-all focus:outline-none focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 hover:border-indigo-300">
        <span class="flex items-center px-2.5 bg-gray-200 border-2 border-gray-300 border-l-0 rounded-r-md text-gray-700 text-xs font-semibold">%</span>
      </div>
    </div>
  </div>

  <div id="result" class="mt-4 p-4 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-lg text-center font-bold shadow-lg min-h-[50px] flex flex-col items-stretch justify-center"></div>
</div>

<script>
// é¡µé¢åŠ è½½æ—¶ç«‹å³è®¡ç®—
window.onload = function() {
  calc();
};

// è·å–å®æ—¶æ±‡ç‡
async function fetchRates() {
  const btn = document.getElementById('fetchBtn');
  btn.disabled = true;
  btn.innerHTML = 'â³ è·å–ä¸­...';
  
  try {
    // ä½¿ç”¨å…è´¹çš„æ±‡ç‡API
    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
    const data = await response.json();
    
    if (data.rates) {
      // æ›´æ–°CADæ±‡ç‡
      if (data.rates.CAD) {
        document.getElementById('cadRate').value = data.rates.CAD.toFixed(4);
      }
      
      // æ›´æ–°CNYæ±‡ç‡
      if (data.rates.CNY) {
        document.getElementById('cnyRate').value = data.rates.CNY.toFixed(4);
      }
      
      // æ›´æ–°è®¡ç®—
      convertCAD();
      
      btn.innerHTML = 'âœ… æ›´æ–°æˆåŠŸ';
      setTimeout(() => {
        btn.innerHTML = 'ğŸ”„ è·å–å®æ—¶æ±‡ç‡';
        btn.disabled = false;
      }, 2000);
    }
  } catch (error) {
    console.error('è·å–æ±‡ç‡å¤±è´¥:', error);
    btn.innerHTML = 'âŒ è·å–å¤±è´¥';
    setTimeout(() => {
      btn.innerHTML = 'ğŸ”„ è·å–å®æ—¶æ±‡ç‡';
      btn.disabled = false;
    }, 2000);
  }
}

function convertCAD() {
  const cad = Number(document.getElementById("cad").value);
  const cadRate = Number(document.getElementById("cadRate").value);
  const usd = cad / cadRate;
  document.getElementById("usd").value = usd.toFixed(3);
  calc();
}

function convertUSD() {
  const usd = Number(document.getElementById("usd").value);
  const cadRate = Number(document.getElementById("cadRate").value);
  const cad = usd * cadRate;
  document.getElementById("cad").value = cad.toFixed(2);
  calc();
}

function calc() {
  const usd = Number(document.getElementById("usd").value);
  const buyRate = Number(document.getElementById("buyRate").value) / 100;

  const shipCNY = Number(document.getElementById("ship").value);
  const bondCNY = Number(document.getElementById("bond").value);

  const platform = Number(document.getElementById("platform").value) / 100;
  const tax = Number(document.getElementById("tax").value) / 100;
  const live = Number(document.getElementById("live").value) / 100;
  const profit = Number(document.getElementById("profit").value) / 100;

  const cnyRate = Number(document.getElementById("cnyRate").value);

  // 1ï¸âƒ£ è¿›è´§æˆæœ¬
  const cost = usd * (1 + buyRate);
  const costCNY = cost * cnyRate;

  // è¿è´¹å’Œä»“å‚¨è´¹ç”¨ï¼ˆè½¬æ¢ä¸ºç¾å…ƒç”¨äºè®¡ç®—ï¼‰
  const ship = shipCNY / cnyRate;
  const bond = bondCNY / cnyRate;

  // 2ï¸âƒ£ æœ€ç»ˆå”®ä»·ç™¾åˆ†æ¯”
  const finalRate = platform + tax + live + profit;

  // 3ï¸âƒ£ åæ¨å”®ä»·
  const price = (cost + ship + bond) / (1 - finalRate);
  const priceInCNY = price * cnyRate;

  // å„é¡¹è´¹ç”¨
  const platformFee = price * platform * cnyRate;
  const taxFee = price * tax * cnyRate;
  const liveFee = price * live * cnyRate;
  const profitAmount = price * profit * cnyRate;

  document.getElementById("result").innerHTML =
    "<div style='font-size: 22px; margin-bottom: 12px;'>æœ€ç»ˆå”®ä»·: <strong>Â¥" + priceInCNY.toFixed(2) + "</strong></div>" +
    "<div style='font-size: 12px; line-height: 1.6; text-align: left; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 6px;'>" +
    "ğŸ“¦ è¿›è´§æˆæœ¬: Â¥" + costCNY.toFixed(2) + "<br>" +
    "ğŸš¢ å›½é™…è¿è´¹: Â¥" + shipCNY.toFixed(2) + "<br>" +
    "ğŸ­ ä¿ç¨ä»“è´¹: Â¥" + bondCNY.toFixed(2) + "<br>" +
    "ğŸª å¹³å°æŠ½ä½£: Â¥" + platformFee.toFixed(2) + "<br>" +
    "ğŸ’° ç¨é‡‘: Â¥" + taxFee.toFixed(2) + "<br>" +
    "ğŸ“º å¸¦è´§ä½£é‡‘: Â¥" + liveFee.toFixed(2) + "<br>" +
    "âœ¨ æ¯›åˆ©: Â¥" + profitAmount.toFixed(2) +
    "</div>";
}
</script>

</body>
</html>
